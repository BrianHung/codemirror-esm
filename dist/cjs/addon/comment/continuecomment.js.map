{"version":3,"file":"continuecomment.js","sources":["../../../../src/addon/comment/continuecomment.js"],"sourcesContent":["// Source: https://github.com/codemirror/CodeMirror/tree/master/addon/comment/continuecomment.js\nexport default function(CodeMirror) {\n  var nonspace = /\\S/g;\n  var repeat = String.prototype.repeat || function (n) { return Array(n + 1).join(this); };\n  function continueComment(cm) {\n    if (cm.getOption(\"disableInput\")) return CodeMirror.Pass;\n    var ranges = cm.listSelections(), mode, inserts = [];\n    for (var i = 0; i < ranges.length; i++) {\n      var pos = ranges[i].head\n      if (!/\\bcomment\\b/.test(cm.getTokenTypeAt(pos))) return CodeMirror.Pass;\n      var modeHere = cm.getModeAt(pos)\n      if (!mode) mode = modeHere;\n      else if (mode != modeHere) return CodeMirror.Pass;\n\n      var insert = null, line, found;\n      var blockStart = mode.blockCommentStart, lineCmt = mode.lineComment;\n      if (blockStart && mode.blockCommentContinue) {\n        line = cm.getLine(pos.line);\n        var end = line.lastIndexOf(mode.blockCommentEnd, pos.ch - mode.blockCommentEnd.length);\n        if (end != -1 && end == pos.ch - mode.blockCommentEnd.length ||\n            lineCmt && (found = line.lastIndexOf(lineCmt, pos.ch - 1)) > -1 &&\n            /\\bcomment\\b/.test(cm.getTokenTypeAt({line: pos.line, ch: found + 1}))) {\n        } else if (pos.ch >= blockStart.length &&\n                   (found = line.lastIndexOf(blockStart, pos.ch - blockStart.length)) > -1 &&\n                   found > end) {\n          if (nonspaceAfter(0, line) >= found) {\n            insert = line.slice(0, found);\n          } else {\n            var tabSize = cm.options.tabSize, numTabs;\n            found = CodeMirror.countColumn(line, found, tabSize);\n            insert = !cm.options.indentWithTabs ? repeat.call(\" \", found) :\n              repeat.call(\"\\t\", (numTabs = Math.floor(found / tabSize))) +\n              repeat.call(\" \", found - tabSize * numTabs);\n          }\n        } else if ((found = line.indexOf(mode.blockCommentContinue)) > -1 &&\n                   found <= pos.ch &&\n                   found <= nonspaceAfter(0, line)) {\n          insert = line.slice(0, found);\n        }\n        if (insert != null) insert += mode.blockCommentContinue\n      }\n      if (insert == null && lineCmt && continueLineCommentEnabled(cm)) {\n        if (line == null) line = cm.getLine(pos.line);\n        found = line.indexOf(lineCmt);\n        if (!pos.ch && !found) insert = \"\";\n        else if (found > -1 && nonspaceAfter(0, line) >= found) {\n          insert = nonspaceAfter(pos.ch, line) > -1;\n          if (!insert) {\n            var next = cm.getLine(pos.line + 1) || '',\n              nextFound = next.indexOf(lineCmt);\n            insert = nextFound > -1 && nonspaceAfter(0, next) >= nextFound || null;\n          }\n          if (insert) {\n            insert = line.slice(0, found) + lineCmt +\n                     line.slice(found + lineCmt.length).match(/^\\s*/)[0];\n          }\n        }\n      }\n      if (insert == null) return CodeMirror.Pass;\n      inserts[i] = \"\\n\" + insert;\n    }\n\n    cm.operation(function() {\n      for (var i = ranges.length - 1; i >= 0; i--)\n        cm.replaceRange(inserts[i], ranges[i].from(), ranges[i].to(), \"+insert\");\n    });\n  }\n\n  function nonspaceAfter(ch, str) {\n    nonspace.lastIndex = ch;\n    var m = nonspace.exec(str);\n    return m ? m.index : -1;\n  }\n\n  function continueLineCommentEnabled(cm) {\n    var opt = cm.getOption(\"continueComments\");\n    if (opt && typeof opt == \"object\")\n      return opt.continueLineComment !== false;\n    return true;\n  }\n\n  CodeMirror.defineOption(\"continueComments\", null, function(cm, val, prev) {\n    if (prev && prev != CodeMirror.Init)\n      cm.removeKeyMap(\"continueComment\");\n    if (val) {\n      var key = \"Enter\";\n      if (typeof val == \"string\")\n        key = val;\n      else if (typeof val == \"object\" && val.key)\n        key = val.key;\n      var map = {name: \"continueComment\"};\n      map[key] = continueComment;\n      cm.addKeyMap(map);\n    }\n  });\n}"],"names":[],"mappings":"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"}
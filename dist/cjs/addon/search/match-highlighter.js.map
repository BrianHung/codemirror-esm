{"version":3,"file":"match-highlighter.js","sources":["../../../../src/addon/search/match-highlighter.js"],"sourcesContent":["// Source: https://github.com/codemirror/CodeMirror/tree/master/addon/search/match-highlighter.js\nimport matchesonscrollbar from \"./matchesonscrollbar\"\nexport default function(CodeMirror) {\n  matchesonscrollbar(CodeMirror)\n  \"use strict\";\n\n  var defaults = {\n    style: \"matchhighlight\",\n    minChars: 2,\n    delay: 100,\n    wordsOnly: false,\n    annotateScrollbar: false,\n    showToken: false,\n    trim: true\n  }\n\n  function State(options) {\n    this.options = {}\n    for (var name in defaults)\n      this.options[name] = (options && options.hasOwnProperty(name) ? options : defaults)[name]\n    this.overlay = this.timeout = null;\n    this.matchesonscroll = null;\n    this.active = false;\n  }\n\n  CodeMirror.defineOption(\"highlightSelectionMatches\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      removeOverlay(cm);\n      clearTimeout(cm.state.matchHighlighter.timeout);\n      cm.state.matchHighlighter = null;\n      cm.off(\"cursorActivity\", cursorActivity);\n      cm.off(\"focus\", onFocus)\n    }\n    if (val) {\n      var state = cm.state.matchHighlighter = new State(val);\n      if (cm.hasFocus()) {\n        state.active = true\n        highlightMatches(cm)\n      } else {\n        cm.on(\"focus\", onFocus)\n      }\n      cm.on(\"cursorActivity\", cursorActivity);\n    }\n  });\n\n  function cursorActivity(cm) {\n    var state = cm.state.matchHighlighter;\n    if (state.active || cm.hasFocus()) scheduleHighlight(cm, state)\n  }\n\n  function onFocus(cm) {\n    var state = cm.state.matchHighlighter\n    if (!state.active) {\n      state.active = true\n      scheduleHighlight(cm, state)\n    }\n  }\n\n  function scheduleHighlight(cm, state) {\n    clearTimeout(state.timeout);\n    state.timeout = setTimeout(function() {highlightMatches(cm);}, state.options.delay);\n  }\n\n  function addOverlay(cm, query, hasBoundary, style) {\n    var state = cm.state.matchHighlighter;\n    cm.addOverlay(state.overlay = makeOverlay(query, hasBoundary, style));\n    if (state.options.annotateScrollbar && cm.showMatchesOnScrollbar) {\n      var searchFor = hasBoundary ? new RegExp((/\\w/.test(query.charAt(0)) ? \"\\\\b\" : \"\") +\n                                               query.replace(/[\\\\\\[.+*?(){|^$]/g, \"\\\\$&\") +\n                                               (/\\w/.test(query.charAt(query.length - 1)) ? \"\\\\b\" : \"\")) : query;\n      state.matchesonscroll = cm.showMatchesOnScrollbar(searchFor, false,\n        {className: \"CodeMirror-selection-highlight-scrollbar\"});\n    }\n  }\n\n  function removeOverlay(cm) {\n    var state = cm.state.matchHighlighter;\n    if (state.overlay) {\n      cm.removeOverlay(state.overlay);\n      state.overlay = null;\n      if (state.matchesonscroll) {\n        state.matchesonscroll.clear();\n        state.matchesonscroll = null;\n      }\n    }\n  }\n\n  function highlightMatches(cm) {\n    cm.operation(function() {\n      var state = cm.state.matchHighlighter;\n      removeOverlay(cm);\n      if (!cm.somethingSelected() && state.options.showToken) {\n        var re = state.options.showToken === true ? /[\\w$]/ : state.options.showToken;\n        var cur = cm.getCursor(), line = cm.getLine(cur.line), start = cur.ch, end = start;\n        while (start && re.test(line.charAt(start - 1))) --start;\n        while (end < line.length && re.test(line.charAt(end))) ++end;\n        if (start < end)\n          addOverlay(cm, line.slice(start, end), re, state.options.style);\n        return;\n      }\n      var from = cm.getCursor(\"from\"), to = cm.getCursor(\"to\");\n      if (from.line != to.line) return;\n      if (state.options.wordsOnly && !isWord(cm, from, to)) return;\n      var selection = cm.getRange(from, to)\n      if (state.options.trim) selection = selection.replace(/^\\s+|\\s+$/g, \"\")\n      if (selection.length >= state.options.minChars)\n        addOverlay(cm, selection, false, state.options.style);\n    });\n  }\n\n  function isWord(cm, from, to) {\n    var str = cm.getRange(from, to);\n    if (str.match(/^\\w+$/) !== null) {\n      if (from.ch > 0) {\n        var pos = {line: from.line, ch: from.ch - 1};\n        var chr = cm.getRange(pos, from);\n        if (chr.match(/\\W/) === null) return false;\n      }\n      if (to.ch < cm.getLine(from.line).length) {\n        var pos = {line: to.line, ch: to.ch + 1};\n        var chr = cm.getRange(to, pos);\n        if (chr.match(/\\W/) === null) return false;\n      }\n      return true;\n    } else return false;\n  }\n\n  function boundariesAround(stream, re) {\n    return (!stream.start || !re.test(stream.string.charAt(stream.start - 1))) &&\n      (stream.pos == stream.string.length || !re.test(stream.string.charAt(stream.pos)));\n  }\n\n  function makeOverlay(query, hasBoundary, style) {\n    return {token: function(stream) {\n      if (stream.match(query) &&\n          (!hasBoundary || boundariesAround(stream, hasBoundary)))\n        return style;\n      stream.next();\n      stream.skipTo(query.charAt(0)) || stream.skipToEnd();\n    }};\n  }\n}"],"names":[],"mappings":"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"}
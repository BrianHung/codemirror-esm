{"version":3,"file":"panel.js","sources":["../../../../src/addon/display/panel.js"],"sourcesContent":["// Source: https://github.com/codemirror/CodeMirror/tree/master/addon/display/panel.js\nexport default function(CodeMirror) {\n  CodeMirror.defineExtension(\"addPanel\", function (node, options) {\n    options = options || {};\n\n    if (!this.state.panels) initPanels(this);\n\n    var info = this.state.panels;\n    var wrapper = info.wrapper;\n    var cmWrapper = this.getWrapperElement();\n    var replace = options.replace instanceof Panel && !options.replace.cleared;\n\n    if (options.after instanceof Panel && !options.after.cleared) {\n      wrapper.insertBefore(node, options.before.node.nextSibling);\n    } else if (options.before instanceof Panel && !options.before.cleared) {\n      wrapper.insertBefore(node, options.before.node);\n    } else if (replace) {\n      wrapper.insertBefore(node, options.replace.node);\n      options.replace.clear(true);\n    } else if (options.position == \"bottom\") {\n      wrapper.appendChild(node);\n    } else if (options.position == \"before-bottom\") {\n      wrapper.insertBefore(node, cmWrapper.nextSibling);\n    } else if (options.position == \"after-top\") {\n      wrapper.insertBefore(node, cmWrapper);\n    } else {\n      wrapper.insertBefore(node, wrapper.firstChild);\n    }\n\n    var height = (options && options.height) || node.offsetHeight;\n\n    var panel = new Panel(this, node, options, height);\n    info.panels.push(panel);\n\n    this.setSize();\n    if (options.stable && isAtTop(this, node))\n      this.scrollTo(null, this.getScrollInfo().top + height);\n\n    return panel;\n  });\n\n  function Panel(cm, node, options, height) {\n    this.cm = cm;\n    this.node = node;\n    this.options = options;\n    this.height = height;\n    this.cleared = false;\n  }\n\n  Panel.prototype.clear = function (skipRemove) {\n    if (this.cleared) return;\n    this.cleared = true;\n    var info = this.cm.state.panels;\n    info.panels.splice(info.panels.indexOf(this), 1);\n    this.cm.setSize();\n    if (this.options.stable && isAtTop(this.cm, this.node))\n      this.cm.scrollTo(null, this.cm.getScrollInfo().top - this.height)\n    info.wrapper.removeChild(this.node);\n    if (info.panels.length == 0 && !skipRemove) removePanels(this.cm);\n  };\n\n  Panel.prototype.changed = function () {\n    this.height = this.node.getBoundingClientRect().height;\n    this.cm.setSize();\n  };\n\n  function initPanels(cm) {\n    var wrap = cm.getWrapperElement();\n    var style = window.getComputedStyle ? window.getComputedStyle(wrap) : wrap.currentStyle;\n    var height = parseInt(style.height);\n    var info = cm.state.panels = {\n      setHeight: wrap.style.height,\n      panels: [],\n      wrapper: document.createElement(\"div\")\n    };\n    wrap.parentNode.insertBefore(info.wrapper, wrap);\n    var hasFocus = cm.hasFocus();\n    info.wrapper.appendChild(wrap);\n    if (hasFocus) cm.focus();\n\n    cm._setSize = cm.setSize;\n    if (height != null) cm.setSize = function (width, newHeight) {\n      if (!newHeight) newHeight = info.wrapper.offsetHeight;\n      info.setHeight = newHeight;\n      if (typeof newHeight != \"number\") {\n        var px = /^(\\d+\\.?\\d*)px$/.exec(newHeight);\n        if (px) {\n          newHeight = Number(px[1]);\n        } else {\n          info.wrapper.style.height = newHeight;\n          newHeight = info.wrapper.offsetHeight;\n        }\n      }\n      var editorheight = newHeight - info.panels\n        .map(function (p) { return p.node.getBoundingClientRect().height; })\n        .reduce(function (a, b) { return a + b; }, 0);\n      cm._setSize(width, editorheight);\n      height = newHeight;\n    };\n  }\n\n  function removePanels(cm) {\n    var info = cm.state.panels;\n    cm.state.panels = null;\n\n    var wrap = cm.getWrapperElement();\n    info.wrapper.parentNode.replaceChild(wrap, info.wrapper);\n    wrap.style.height = info.setHeight;\n    cm.setSize = cm._setSize;\n    cm.setSize();\n  }\n\n  function isAtTop(cm, dom) {\n    for (var sibling = dom.nextSibling; sibling; sibling = sibling.nextSibling)\n      if (sibling == cm.getWrapperElement()) return true\n    return false\n  }\n}"],"names":[],"mappings":"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"}
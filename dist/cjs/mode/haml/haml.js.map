{"version":3,"file":"haml.js","sources":["../../../../src/mode/haml/haml.js"],"sourcesContent":["// Source: https://github.com/codemirror/CodeMirror/tree/master/mode/haml/haml.js\nimport htmlmixed from \"../htmlmixed/htmlmixed\"\nimport ruby from \"../ruby/ruby\"\nexport default function(CodeMirror) {\n  htmlmixed(CodeMirror)\n  ruby(CodeMirror)\n  \"use strict\";\n\n  CodeMirror.defineMode(\"haml\", function(config) {\n    var htmlMode = CodeMirror.getMode(config, {name: \"htmlmixed\"});\n    var rubyMode = CodeMirror.getMode(config, \"ruby\");\n\n    function rubyInQuote(endQuote) {\n      return function(stream, state) {\n        var ch = stream.peek();\n        if (ch == endQuote && state.rubyState.tokenize.length == 1) {\n          stream.next();\n          state.tokenize = html;\n          return \"closeAttributeTag\";\n        } else {\n          return ruby(stream, state);\n        }\n      };\n    }\n\n    function ruby(stream, state) {\n      if (stream.match(\"-#\")) {\n        stream.skipToEnd();\n        return \"comment\";\n      }\n      return rubyMode.token(stream, state.rubyState);\n    }\n\n    function html(stream, state) {\n      var ch = stream.peek();\n\n      if (state.previousToken.style == \"comment\" ) {\n        if (state.indented > state.previousToken.indented) {\n          stream.skipToEnd();\n          return \"commentLine\";\n        }\n      }\n\n      if (state.startOfLine) {\n        if (ch == \"!\" && stream.match(\"!!\")) {\n          stream.skipToEnd();\n          return \"tag\";\n        } else if (stream.match(/^%[\\w:#\\.]+=/)) {\n          state.tokenize = ruby;\n          return \"hamlTag\";\n        } else if (stream.match(/^%[\\w:]+/)) {\n          return \"hamlTag\";\n        } else if (ch == \"/\" ) {\n          stream.skipToEnd();\n          return \"comment\";\n        }\n      }\n\n      if (state.startOfLine || state.previousToken.style == \"hamlTag\") {\n        if ( ch == \"#\" || ch == \".\") {\n          stream.match(/[\\w-#\\.]*/);\n          return \"hamlAttribute\";\n        }\n      }\n\n      if (state.startOfLine && !stream.match(\"-->\", false) && (ch == \"=\" || ch == \"-\" )) {\n        state.tokenize = ruby;\n        return state.tokenize(stream, state);\n      }\n\n      if (state.previousToken.style == \"hamlTag\" ||\n          state.previousToken.style == \"closeAttributeTag\" ||\n          state.previousToken.style == \"hamlAttribute\") {\n        if (ch == \"(\") {\n          state.tokenize = rubyInQuote(\")\");\n          return state.tokenize(stream, state);\n        } else if (ch == \"{\") {\n          if (!stream.match(/^\\{%.*/)) {\n            state.tokenize = rubyInQuote(\"}\");\n            return state.tokenize(stream, state);\n          }\n        }\n      }\n\n      return htmlMode.token(stream, state.htmlState);\n    }\n\n    return {\n      startState: function() {\n        var htmlState = CodeMirror.startState(htmlMode);\n        var rubyState = CodeMirror.startState(rubyMode);\n        return {\n          htmlState: htmlState,\n          rubyState: rubyState,\n          indented: 0,\n          previousToken: { style: null, indented: 0},\n          tokenize: html\n        };\n      },\n\n      copyState: function(state) {\n        return {\n          htmlState : CodeMirror.copyState(htmlMode, state.htmlState),\n          rubyState: CodeMirror.copyState(rubyMode, state.rubyState),\n          indented: state.indented,\n          previousToken: state.previousToken,\n          tokenize: state.tokenize\n        };\n      },\n\n      token: function(stream, state) {\n        if (stream.sol()) {\n          state.indented = stream.indentation();\n          state.startOfLine = true;\n        }\n        if (stream.eatSpace()) return null;\n        var style = state.tokenize(stream, state);\n        state.startOfLine = false;\n        if (style && style != \"commentLine\") {\n          state.previousToken = { style: style, indented: state.indented };\n        }\n        if (stream.eol() && state.tokenize == ruby) {\n          stream.backUp(1);\n          var ch = stream.peek();\n          stream.next();\n          if (ch && ch != \",\") {\n            state.tokenize = html;\n          }\n        }\n        if (style == \"hamlTag\") {\n          style = \"tag\";\n        } else if (style == \"commentLine\") {\n          style = \"comment\";\n        } else if (style == \"hamlAttribute\") {\n          style = \"attribute\";\n        } else if (style == \"closeAttributeTag\") {\n          style = null;\n        }\n        return style;\n      }\n    };\n  }, \"htmlmixed\", \"ruby\");\n\n  CodeMirror.defineMIME(\"text/x-haml\", \"haml\");\n}"],"names":[],"mappings":"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"}
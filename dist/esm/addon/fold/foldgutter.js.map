{"version":3,"file":"foldgutter.js","sources":["../../../../src/addon/fold/foldgutter.js"],"sourcesContent":["// Source: https://github.com/codemirror/CodeMirror/tree/master/addon/fold/foldgutter.js\nimport foldcode from \"./foldcode\"\nexport default function(CodeMirror) {\n  foldcode(CodeMirror)\n  \"use strict\";\n\n  CodeMirror.defineOption(\"foldGutter\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      cm.clearGutter(cm.state.foldGutter.options.gutter);\n      cm.state.foldGutter = null;\n      cm.off(\"gutterClick\", onGutterClick);\n      cm.off(\"changes\", onChange);\n      cm.off(\"viewportChange\", onViewportChange);\n      cm.off(\"fold\", onFold);\n      cm.off(\"unfold\", onFold);\n      cm.off(\"swapDoc\", onChange);\n    }\n    if (val) {\n      cm.state.foldGutter = new State(parseOptions(val));\n      updateInViewport(cm);\n      cm.on(\"gutterClick\", onGutterClick);\n      cm.on(\"changes\", onChange);\n      cm.on(\"viewportChange\", onViewportChange);\n      cm.on(\"fold\", onFold);\n      cm.on(\"unfold\", onFold);\n      cm.on(\"swapDoc\", onChange);\n    }\n  });\n\n  var Pos = CodeMirror.Pos;\n\n  function State(options) {\n    this.options = options;\n    this.from = this.to = 0;\n  }\n\n  function parseOptions(opts) {\n    if (opts === true) opts = {};\n    if (opts.gutter == null) opts.gutter = \"CodeMirror-foldgutter\";\n    if (opts.indicatorOpen == null) opts.indicatorOpen = \"CodeMirror-foldgutter-open\";\n    if (opts.indicatorFolded == null) opts.indicatorFolded = \"CodeMirror-foldgutter-folded\";\n    return opts;\n  }\n\n  function isFolded(cm, line) {\n    var marks = cm.findMarks(Pos(line, 0), Pos(line + 1, 0));\n    for (var i = 0; i < marks.length; ++i) {\n      if (marks[i].__isFold) {\n        var fromPos = marks[i].find(-1);\n        if (fromPos && fromPos.line === line)\n          return marks[i];\n      }\n    }\n  }\n\n  function marker(spec) {\n    if (typeof spec == \"string\") {\n      var elt = document.createElement(\"div\");\n      elt.className = spec + \" CodeMirror-guttermarker-subtle\";\n      return elt;\n    } else {\n      return spec.cloneNode(true);\n    }\n  }\n\n  function updateFoldInfo(cm, from, to) {\n    var opts = cm.state.foldGutter.options, cur = from - 1;\n    var minSize = cm.foldOption(opts, \"minFoldSize\");\n    var func = cm.foldOption(opts, \"rangeFinder\");\n    var clsFolded = typeof opts.indicatorFolded == \"string\" && classTest(opts.indicatorFolded);\n    var clsOpen = typeof opts.indicatorOpen == \"string\" && classTest(opts.indicatorOpen);\n    cm.eachLine(from, to, function(line) {\n      ++cur;\n      var mark = null;\n      var old = line.gutterMarkers;\n      if (old) old = old[opts.gutter];\n      if (isFolded(cm, cur)) {\n        if (clsFolded && old && clsFolded.test(old.className)) return;\n        mark = marker(opts.indicatorFolded);\n      } else {\n        var pos = Pos(cur, 0);\n        var range = func && func(cm, pos);\n        if (range && range.to.line - range.from.line >= minSize) {\n          if (clsOpen && old && clsOpen.test(old.className)) return;\n          mark = marker(opts.indicatorOpen);\n        }\n      }\n      if (!mark && !old) return;\n      cm.setGutterMarker(line, opts.gutter, mark);\n    });\n  }\n\n  function classTest(cls) { return new RegExp(\"(^|\\\\s)\" + cls + \"(?:$|\\\\s)\\\\s*\") }\n\n  function updateInViewport(cm) {\n    var vp = cm.getViewport(), state = cm.state.foldGutter;\n    if (!state) return;\n    cm.operation(function() {\n      updateFoldInfo(cm, vp.from, vp.to);\n    });\n    state.from = vp.from; state.to = vp.to;\n  }\n\n  function onGutterClick(cm, line, gutter) {\n    var state = cm.state.foldGutter;\n    if (!state) return;\n    var opts = state.options;\n    if (gutter != opts.gutter) return;\n    var folded = isFolded(cm, line);\n    if (folded) folded.clear();\n    else cm.foldCode(Pos(line, 0), opts);\n  }\n\n  function onChange(cm) {\n    var state = cm.state.foldGutter;\n    if (!state) return;\n    var opts = state.options;\n    state.from = state.to = 0;\n    clearTimeout(state.changeUpdate);\n    state.changeUpdate = setTimeout(function() { updateInViewport(cm); }, opts.foldOnChangeTimeSpan || 600);\n  }\n\n  function onViewportChange(cm) {\n    var state = cm.state.foldGutter;\n    if (!state) return;\n    var opts = state.options;\n    clearTimeout(state.changeUpdate);\n    state.changeUpdate = setTimeout(function() {\n      var vp = cm.getViewport();\n      if (state.from == state.to || vp.from - state.to > 20 || state.from - vp.to > 20) {\n        updateInViewport(cm);\n      } else {\n        cm.operation(function() {\n          if (vp.from < state.from) {\n            updateFoldInfo(cm, vp.from, state.from);\n            state.from = vp.from;\n          }\n          if (vp.to > state.to) {\n            updateFoldInfo(cm, state.to, vp.to);\n            state.to = vp.to;\n          }\n        });\n      }\n    }, opts.updateViewportTimeSpan || 400);\n  }\n\n  function onFold(cm, from) {\n    var state = cm.state.foldGutter;\n    if (!state) return;\n    var line = from.line;\n    if (line >= state.from && line < state.to)\n      updateFoldInfo(cm, line, line + 1);\n  }\n}"],"names":[],"mappings":"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"}
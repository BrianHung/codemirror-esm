{"version":3,"file":"mark-selection.js","sources":["../../../../src/addon/selection/mark-selection.js"],"sourcesContent":["// Source: https://github.com/codemirror/CodeMirror/tree/master/addon/selection/mark-selection.js\nexport default function(CodeMirror) {\n  \"use strict\";\n\n  CodeMirror.defineOption(\"styleSelectedText\", false, function(cm, val, old) {\n    var prev = old && old != CodeMirror.Init;\n    if (val && !prev) {\n      cm.state.markedSelection = [];\n      cm.state.markedSelectionStyle = typeof val == \"string\" ? val : \"CodeMirror-selectedtext\";\n      reset(cm);\n      cm.on(\"cursorActivity\", onCursorActivity);\n      cm.on(\"change\", onChange);\n    } else if (!val && prev) {\n      cm.off(\"cursorActivity\", onCursorActivity);\n      cm.off(\"change\", onChange);\n      clear(cm);\n      cm.state.markedSelection = cm.state.markedSelectionStyle = null;\n    }\n  });\n\n  function onCursorActivity(cm) {\n    if (cm.state.markedSelection)\n      cm.operation(function() { update(cm); });\n  }\n\n  function onChange(cm) {\n    if (cm.state.markedSelection && cm.state.markedSelection.length)\n      cm.operation(function() { clear(cm); });\n  }\n\n  var CHUNK_SIZE = 8;\n  var Pos = CodeMirror.Pos;\n  var cmp = CodeMirror.cmpPos;\n\n  function coverRange(cm, from, to, addAt) {\n    if (cmp(from, to) == 0) return;\n    var array = cm.state.markedSelection;\n    var cls = cm.state.markedSelectionStyle;\n    for (var line = from.line;;) {\n      var start = line == from.line ? from : Pos(line, 0);\n      var endLine = line + CHUNK_SIZE, atEnd = endLine >= to.line;\n      var end = atEnd ? to : Pos(endLine, 0);\n      var mark = cm.markText(start, end, {className: cls});\n      if (addAt == null) array.push(mark);\n      else array.splice(addAt++, 0, mark);\n      if (atEnd) break;\n      line = endLine;\n    }\n  }\n\n  function clear(cm) {\n    var array = cm.state.markedSelection;\n    for (var i = 0; i < array.length; ++i) array[i].clear();\n    array.length = 0;\n  }\n\n  function reset(cm) {\n    clear(cm);\n    var ranges = cm.listSelections();\n    for (var i = 0; i < ranges.length; i++)\n      coverRange(cm, ranges[i].from(), ranges[i].to());\n  }\n\n  function update(cm) {\n    if (!cm.somethingSelected()) return clear(cm);\n    if (cm.listSelections().length > 1) return reset(cm);\n\n    var from = cm.getCursor(\"start\"), to = cm.getCursor(\"end\");\n\n    var array = cm.state.markedSelection;\n    if (!array.length) return coverRange(cm, from, to);\n\n    var coverStart = array[0].find(), coverEnd = array[array.length - 1].find();\n    if (!coverStart || !coverEnd || to.line - from.line <= CHUNK_SIZE ||\n        cmp(from, coverEnd.to) >= 0 || cmp(to, coverStart.from) <= 0)\n      return reset(cm);\n\n    while (cmp(from, coverStart.from) > 0) {\n      array.shift().clear();\n      coverStart = array[0].find();\n    }\n    if (cmp(from, coverStart.from) < 0) {\n      if (coverStart.to.line - from.line < CHUNK_SIZE) {\n        array.shift().clear();\n        coverRange(cm, from, coverStart.to, 0);\n      } else {\n        coverRange(cm, from, coverStart.from, 0);\n      }\n    }\n\n    while (cmp(to, coverEnd.to) < 0) {\n      array.pop().clear();\n      coverEnd = array[array.length - 1].find();\n    }\n    if (cmp(to, coverEnd.to) > 0) {\n      if (to.line - coverEnd.from.line < CHUNK_SIZE) {\n        array.pop().clear();\n        coverRange(cm, coverEnd.from, to);\n      } else {\n        coverRange(cm, coverEnd.to, to);\n      }\n    }\n  }\n}"],"names":[],"mappings":"AAAA;AACe,uBAAS,UAAU,EAAE;AAEpC;AACA,EAAE,UAAU,CAAC,YAAY,CAAC,mBAAmB,EAAE,KAAK,EAAE,SAAS,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE;AAC7E,IAAI,IAAI,IAAI,GAAG,GAAG,IAAI,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC;AAC7C,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,EAAE;AACtB,MAAM,EAAE,CAAC,KAAK,CAAC,eAAe,GAAG,EAAE,CAAC;AACpC,MAAM,EAAE,CAAC,KAAK,CAAC,oBAAoB,GAAG,OAAO,GAAG,IAAI,QAAQ,GAAG,GAAG,GAAG,yBAAyB,CAAC;AAC/F,MAAM,KAAK,CAAC,EAAE,CAAC,CAAC;AAChB,MAAM,EAAE,CAAC,EAAE,CAAC,gBAAgB,EAAE,gBAAgB,CAAC,CAAC;AAChD,MAAM,EAAE,CAAC,EAAE,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AAChC,KAAK,MAAM,IAAI,CAAC,GAAG,IAAI,IAAI,EAAE;AAC7B,MAAM,EAAE,CAAC,GAAG,CAAC,gBAAgB,EAAE,gBAAgB,CAAC,CAAC;AACjD,MAAM,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;AACjC,MAAM,KAAK,CAAC,EAAE,CAAC,CAAC;AAChB,MAAM,EAAE,CAAC,KAAK,CAAC,eAAe,GAAG,EAAE,CAAC,KAAK,CAAC,oBAAoB,GAAG,IAAI,CAAC;AACtE,KAAK;AACL,GAAG,CAAC,CAAC;AACL;AACA,EAAE,SAAS,gBAAgB,CAAC,EAAE,EAAE;AAChC,IAAI,IAAI,EAAE,CAAC,KAAK,CAAC,eAAe;AAChC,QAAM,EAAE,CAAC,SAAS,CAAC,WAAW,EAAE,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAC;AAC/C,GAAG;AACH;AACA,EAAE,SAAS,QAAQ,CAAC,EAAE,EAAE;AACxB,IAAI,IAAI,EAAE,CAAC,KAAK,CAAC,eAAe,IAAI,EAAE,CAAC,KAAK,CAAC,eAAe,CAAC,MAAM;AACnE,QAAM,EAAE,CAAC,SAAS,CAAC,WAAW,EAAE,KAAK,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,GAAC;AAC9C,GAAG;AACH;AACA,EAAE,IAAI,UAAU,GAAG,CAAC,CAAC;AACrB,EAAE,IAAI,GAAG,GAAG,UAAU,CAAC,GAAG,CAAC;AAC3B,EAAE,IAAI,GAAG,GAAG,UAAU,CAAC,MAAM,CAAC;AAC9B;AACA,EAAE,SAAS,UAAU,CAAC,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,KAAK,EAAE;AAC3C,IAAI,IAAI,GAAG,CAAC,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,IAAE,SAAO;AACnC,IAAI,IAAI,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,eAAe,CAAC;AACzC,IAAI,IAAI,GAAG,GAAG,EAAE,CAAC,KAAK,CAAC,oBAAoB,CAAC;AAC5C,IAAI,KAAK,IAAI,IAAI,GAAG,IAAI,CAAC,IAAI,IAAI;AACjC,MAAM,IAAI,KAAK,GAAG,IAAI,IAAI,IAAI,CAAC,IAAI,GAAG,IAAI,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;AAC1D,MAAM,IAAI,OAAO,GAAG,IAAI,GAAG,UAAU,EAAE,KAAK,GAAG,OAAO,IAAI,EAAE,CAAC,IAAI,CAAC;AAClE,MAAM,IAAI,GAAG,GAAG,KAAK,GAAG,EAAE,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;AAC7C,MAAM,IAAI,IAAI,GAAG,EAAE,CAAC,QAAQ,CAAC,KAAK,EAAE,GAAG,EAAE,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC,CAAC;AAC3D,MAAM,IAAI,KAAK,IAAI,IAAI,IAAE,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,GAAC;AAC1C,aAAW,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,GAAC;AAC1C,MAAM,IAAI,KAAK,IAAE,QAAM;AACvB,MAAM,IAAI,GAAG,OAAO,CAAC;AACrB,KAAK;AACL,GAAG;AACH;AACA,EAAE,SAAS,KAAK,CAAC,EAAE,EAAE;AACrB,IAAI,IAAI,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,eAAe,CAAC;AACzC,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC,IAAE,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,GAAC;AAC5D,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;AACrB,GAAG;AACH;AACA,EAAE,SAAS,KAAK,CAAC,EAAE,EAAE;AACrB,IAAI,KAAK,CAAC,EAAE,CAAC,CAAC;AACd,IAAI,IAAI,MAAM,GAAG,EAAE,CAAC,cAAc,EAAE,CAAC;AACrC,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE;AAC1C,QAAM,UAAU,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,GAAC;AACvD,GAAG;AACH;AACA,EAAE,SAAS,MAAM,CAAC,EAAE,EAAE;AACtB,IAAI,IAAI,CAAC,EAAE,CAAC,iBAAiB,EAAE,IAAE,OAAO,KAAK,CAAC,EAAE,CAAC,GAAC;AAClD,IAAI,IAAI,EAAE,CAAC,cAAc,EAAE,CAAC,MAAM,GAAG,CAAC,IAAE,OAAO,KAAK,CAAC,EAAE,CAAC,GAAC;AACzD;AACA,IAAI,IAAI,IAAI,GAAG,EAAE,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AAC/D;AACA,IAAI,IAAI,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,eAAe,CAAC;AACzC,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,IAAE,OAAO,UAAU,CAAC,EAAE,EAAE,IAAI,EAAE,EAAE,CAAC,GAAC;AACvD;AACA,IAAI,IAAI,UAAU,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;AAChF,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,QAAQ,IAAI,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,IAAI,UAAU;AACrE,QAAQ,GAAG,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,EAAE,EAAE,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC;AACpE,QAAM,OAAO,KAAK,CAAC,EAAE,CAAC,GAAC;AACvB;AACA,IAAI,OAAO,GAAG,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;AAC3C,MAAM,KAAK,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,CAAC;AAC5B,MAAM,UAAU,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;AACnC,KAAK;AACL,IAAI,IAAI,GAAG,CAAC,IAAI,EAAE,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;AACxC,MAAM,IAAI,UAAU,CAAC,EAAE,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,UAAU,EAAE;AACvD,QAAQ,KAAK,CAAC,KAAK,EAAE,CAAC,KAAK,EAAE,CAAC;AAC9B,QAAQ,UAAU,CAAC,EAAE,EAAE,IAAI,EAAE,UAAU,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;AAC/C,OAAO,MAAM;AACb,QAAQ,UAAU,CAAC,EAAE,EAAE,IAAI,EAAE,UAAU,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;AACjD,OAAO;AACP,KAAK;AACL;AACA,IAAI,OAAO,GAAG,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE;AACrC,MAAM,KAAK,CAAC,GAAG,EAAE,CAAC,KAAK,EAAE,CAAC;AAC1B,MAAM,QAAQ,GAAG,KAAK,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;AAChD,KAAK;AACL,IAAI,IAAI,GAAG,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE;AAClC,MAAM,IAAI,EAAE,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,IAAI,GAAG,UAAU,EAAE;AACrD,QAAQ,KAAK,CAAC,GAAG,EAAE,CAAC,KAAK,EAAE,CAAC;AAC5B,QAAQ,UAAU,CAAC,EAAE,EAAE,QAAQ,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;AAC1C,OAAO,MAAM;AACb,QAAQ,UAAU,CAAC,EAAE,EAAE,QAAQ,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;AACxC,OAAO;AACP,KAAK;AACL,GAAG;AACH;;;;"}